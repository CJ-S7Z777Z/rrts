<!DOCTYPE html>
<html>
<head>
<title>Gyro Ball Game</title>
<style>
body { margin: 0; overflow: hidden; }
canvas { display: block; }
#gameCanvas { background-color: #f0f0f0; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let ballX = canvas.width / 2;
let ballY = canvas.height / 4;
let ballRadius = 15;
let ballSpeed = 2; // Управление скоростью
let gravity = 0.2;
let speedX = 0;
let speedY = 0;

// Лабиринт (простой пример)
const maze = [
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
  [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
  [1, 0, 1, 1, 1, 1, 1, 1, 0, 1],
  [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
  [1, 1, 1, 1, 1, 1, 1, 1, 0, 1],
  [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
  [1, 0, 1, 1, 1, 1, 1, 0, 1, 1],
  [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
];

const cellSize = canvas.width / maze[0].length;


function drawBall() {
  ctx.beginPath();
  ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
  ctx.fillStyle = "#FFD700"; // Золотой мяч
  ctx.fill();
  ctx.closePath();
}

function drawMaze() {
  for (let row = 0; row < maze.length; row++) {
    for (let col = 0; col < maze[row].length; col++) {
      if (maze[row][col] === 1) {
        ctx.fillStyle = "gray";
        ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
      }
    }
  }
}

function drawGoal() {
  ctx.fillStyle = "#007bff"; // Синяя чаша
  ctx.beginPath();
  ctx.arc(canvas.width - cellSize / 2, canvas.height - cellSize / 2, cellSize / 2, 0, Math.PI * 2);
  ctx.fill();
}

function handleGyroData(event) {
    // Улучшенная обработка гироскопа:  более плавное и точное управление
    let tiltX = event.gamma / 90; // Нормализация для диапазона -1 до 1
    let tiltY = event.beta / 90; // Нормализация для диапазона -1 до 1
    speedX = tiltX * ballSpeed;
    speedY = tiltY * ballSpeed;
}


function update() {
  ballX += speedX;
  ballY += speedY;
  speedY += gravity;

  // Столкновение со стенами лабиринта
  const cellRow = Math.floor(ballY / cellSize);
  const cellCol = Math.floor(ballX / cellSize);
  if (cellRow >= 0 && cellRow < maze.length && cellCol >= 0 && cellCol < maze[0].length && maze[cellRow][cellCol] === 1) {
    // Отскок от стены
    const collisionX = (ballX % cellSize < ballRadius) ? -1 : (ballX % cellSize > cellSize - ballRadius) ? 1 : 0;
    const collisionY = (ballY % cellSize < ballRadius) ? -1 : (ballY % cellSize > cellSize - ballRadius) ? 1 : 0;
    speedX = -speedX * (collisionX===0?1:0.8);
    speedY = -speedY * (collisionY===0?1:0.8);
  }


  // Проверка попадания в цель
  const distToGoal = Math.sqrt(Math.pow(ballX - (canvas.width - cellSize / 2), 2) + Math.pow(ballY - (canvas.height - cellSize / 2), 2));
  if (distToGoal < ballRadius + cellSize / 2) {
    alert("Вы попали!");
    resetBall();
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawMaze();
  drawBall();
  drawGoal();
  requestAnimationFrame(update);
}


function resetBall() {
  ballX = canvas.width / 2;
  ballY = canvas.height / 4;
  speedX = 0;
  speedY = 0;
}

if (window.DeviceOrientationEvent) {
  window.addEventListener('deviceorientation', handleGyroData);
} else {
  console.log("Гироскоп не поддерживается.");
}

update();
</script>
</body>
</html>
